---
title: "Seoul Bike Sharing"
output:
  html_document: 
    df_print: paged
  pdf_document: default
---

The dataset available on "https://archive.ics.uci.edu/ml/index.php" contains data about how many public bikes are rented at each hour by the Seoul Bike Sharing System with the corresponding weather and holidays informations. 
The goal of this project is looking for the best model to perform a regression task about the number of public bikes rented at each hour ("Rented.Bike.Count") in relation to the other features of the dataset.
	
```{r, echo=FALSE}
#install.packages('fastDummies')
#one of the group members has to delete the special character 'Â°' from some of the column names in the csv file to avoid an error in make.names(...)
library('fastDummies')
df <- read.csv("SeoulBikeData.csv",header=TRUE)
str(df)
```

The multivariate dataframe consists of 8760 observations and 14 variables. Since for each day we have access to the data for each hour, this means we have 365 distinct days.
```{r,echo=FALSE}
print(df[c(1,dim(df)[1]),"Date"],max.levels = 0)
```

While it is useful to have separated data for each hour, we won't be able to understand if a behaviour for a specific holiday repeats over the years (if for example during 01/01/2018 a few bikes were used, since it is the only New Years Eve we have we cannot give accurate predictions about the next ones but only about holiday days in general).

There are 18 holiday days in the dataset (New Years Eve, Buddha's birthday, Day of Independence and so on)
```{r,echo=FALSE}
print(c(unique(df[df[,"Holiday"]=="Holiday",]["Date"])),max.levels = 0)
```

The feature "Functioning.day" indicates if there are data about the number of bikes rented. We can see that for 12 days there are no data for the entire day, while in 06/10/2018 there are data from the 7 am
```{r,echo=FALSE}
table(df["Functioning.Day"])
print(c(unique(df[df[,"Functioning.Day"]=="No",]["Date"])),max.levels = 0)
print(c(df[df[,"Date"]=="06/10/2018",][,c("Hour","Functioning.Day")]),max.levels = 0)
```

ESCLUDERE RIGHE CON FUNCTIONINGDAY = No ?
```{r}
df = df[df[,"Functioning.Day"]=="Yes",]
```


There are no NA values in the dataframe
```{r}
sum(any(is.na(df[,])))
```
```{r,echo=FALSE}
#add feature to have the total bikes rented in each day
df$Daily.Rented.Bikes <- ave(df$Rented.Bike.Count,df$Date,FUN=sum)
```

```{r}
df$Date <- as.Date(df$Date,format="%d/%m/%Y")
```

We can see the average number of bikes rented for day is low in Winter, increase in Spring, reaches the maximum in June, there is a slight decrease until August (probably some users go outside of the city during the Summer), increases again in September (end of the summer holidays) and then starts decreasing in October.
```{r,echo=FALSE}
plot(df$Date,df$Daily.Rented.Bikes,main="Bikes rented for day",xlab="Day",ylab="Rented Bikes")
```

We can see the average number of bikes rented in Winter is much less than the average number in the other seasons (because of the low temperatures). 
Summer has the highest average, while Autumn has a higher average than Spring probably because it benefits from the hot climate still present for a few weeks at the end of the summer season.

```{r,echo=FALSE}
df$Seasons <- as.factor(df$Seasons)
plot(df$Seasons,df$Daily.Rented.Bikes,main="Bikes rented for season",xlab="Season",ylab="Rented Bikes")
```

Non Holiday days are characterized by an average of rented bikes greater than that of Holidays days. This is due to the small number of Holiday days in the year
```{r,echo=FALSE}
df$Holiday <- as.factor(df$Holiday)
plot(df$Holiday,df$Daily.Rented.Bikes,main="Bikes rented for holiday",xlab="Holiday",ylab="Rented Bikes")
```

We add a factor variable related to the hour time
```{r}
df$Time <- ifelse(df$Hour>=18, 'Evening',
                  ifelse(df$Hour>=12, 'Afternoon',
                         ifelse(df$Hour>=6, 'Morning',
                                ifelse(df$Hour>=0, 'Night'))))
df$Time <- as.factor(df$Time)
```


```{r}
plot(df$Time,df$Rented.Bike.Count,main="Bikes rented for Time",xlab="Time",ylab="Rented Bikes")
```

*********************
Vedere grafici delle situazioni ambientali gioraliere a seconda del giorno/stagione
Fare grafico per vedere il numero medio di bici per ora
***********************

We get dummy variables from the categorial features
```{r}
library(fastDummies)
df$Holiday<-ifelse(df$Holiday=="Holiday",1,0)
df <- dummy_cols(df, select_columns = c('Seasons','Time'))
```


```{r}
library(data.table)
setnames(df,old = c("Seasons_Autumn","Seasons_Spring","Seasons_Summer","Seasons_Winter",
                    "Time_Afternoon","Time_Evening","Time_Morning","Time_Night"),new = c("Autumn","Spring","Summer","Winter","Afternoon","Evening","Morning","Night"))
```


```{r}
df
```

